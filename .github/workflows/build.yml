name: Build WebView App

on:
  push:
    tags:
      - "v*" # Trigger when pushing tags starting with v, e.g. v1.0.0

jobs:
  prepare:
    name: Prepare Build Configuration
    runs-on: ubuntu-latest
    outputs:
      build_android: ${{ steps.config.outputs.build_android }}
      build_ios: ${{ steps.config.outputs.build_ios }}
      need_debug: ${{ steps.config.outputs.need_debug }}
      app_version: ${{ steps.config.outputs.app_version }}

    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          submodules: 'recursive'

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.x'

      - name: Read build configuration
        id: config
        run: |
          # è¯»å– build.app
          APP_NAME=$(grep 'appName=' assets/build.app | cut -d'=' -f2)
          echo "App Name: $APP_NAME"
          
          # è¯»å–é…ç½®æ–‡ä»¶
          CONFIG_FILE="assets/$APP_NAME/app.cfg"
          
          # æå–é…ç½®å€¼
          BUILD_ANDROID=$(grep '^buildAndroid=' $CONFIG_FILE | cut -d'=' -f2 | tr '[:upper:]' '[:lower:]')
          BUILD_IOS=$(grep '^buildIOS=' $CONFIG_FILE | cut -d'=' -f2 | tr '[:upper:]' '[:lower:]')
          NEED_DEBUG=$(grep '^needDebug=' $CONFIG_FILE | cut -d'=' -f2 | tr '[:upper:]' '[:lower:]')
          APP_VERSION=$(grep '^appVersion=' $CONFIG_FILE | cut -d'=' -f2)
          
          # è®¾ç½®é»˜è®¤å€¼
          NEED_DEBUG=${NEED_DEBUG:-false}
          
          echo "build_android=$BUILD_ANDROID" >> $GITHUB_OUTPUT
          echo "build_ios=$BUILD_IOS" >> $GITHUB_OUTPUT
          echo "need_debug=$NEED_DEBUG" >> $GITHUB_OUTPUT
          echo "app_version=$APP_VERSION" >> $GITHUB_OUTPUT
          
          echo "Build Android: $BUILD_ANDROID"
          echo "Build iOS: $BUILD_IOS"
          echo "Need Debug: $NEED_DEBUG"
          echo "App Version: $APP_VERSION"

  build-android:
    name: Build Android App
    needs: prepare
    if: needs.prepare.outputs.build_android == 'true'
    runs-on: ubuntu-latest
    permissions:
      contents: write
      packages: write

    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          submodules: 'recursive'
          token: ${{ secrets.TOKEN }}

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.x'

      - name: Install Python dependencies
        run: |
          pip install Pillow

      - name: Configure project
        run: |
          python3 scripts/build_config.py ${{ github.workspace }}

      - name: Verify build configuration
        run: |
          chmod +x scripts/verify_build.sh
          bash scripts/verify_build.sh

      - name: Set up JDK 17
        uses: actions/setup-java@v4
        with:
          java-version: '17'
          distribution: 'temurin'
          cache: gradle

      - name: Grant execute permission for gradlew
        run: chmod +x android/gradlew
        working-directory: ./

      - name: Clean Android build
        run: ./gradlew clean
        working-directory: ./android

      - name: Decode and create keystore
        run: |
          echo "${{ secrets.ANDROID_KEYSTORE_BASE64 }}" | base64 --decode > android/app/${{ secrets.ANDROID_KEYSTORE_FILE || 'devdroid.jks' }}
        working-directory: ./

      - name: Build Debug APK
        if: needs.prepare.outputs.need_debug == 'true'
        run: ./gradlew assembleDebug
        working-directory: ./android

      - name: Build Release APK
        run: ./gradlew assembleRelease
        working-directory: ./android
        env:
          KEYSTORE_FILE: ${{ secrets.ANDROID_KEYSTORE_FILE || 'devdroid.jks' }}
          KEYSTORE_PASSWORD: ${{ secrets.ANDROID_KEYSTORE_PASSWORD }}
          KEY_ALIAS: ${{ secrets.ANDROID_KEY_ALIAS }}
          KEY_PASSWORD: ${{ secrets.ANDROID_KEY_PASSWORD }}

      - name: Upload Android Debug APK
        if: needs.prepare.outputs.need_debug == 'true'
        uses: actions/upload-artifact@v4
        with:
          name: android-apk-debug
          path: android/app/build/outputs/apk/debug/*.apk

      - name: Upload Android Release APK
        uses: actions/upload-artifact@v4
        with:
          name: android-apk-release
          path: android/app/build/outputs/apk/release/*.apk

  build-ios:
    name: Build iOS App
    needs: prepare
    if: needs.prepare.outputs.build_ios == 'true'
    runs-on: macos-latest
    permissions:
      contents: write
      packages: write

    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          submodules: 'recursive'
          token: ${{ secrets.TOKEN }}

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.x'

      - name: Install Python dependencies
        run: |
          pip install Pillow PyJWT requests cryptography

      - name: Configure project
        run: |
          python3 scripts/build_config.py ${{ github.workspace }}

      - name: Verify build configuration (iOS)
        run: |
          chmod +x scripts/verify_build.sh
          bash scripts/verify_build.sh

      - name: Setup Xcode
        uses: maxim-lobanov/setup-xcode@v1
        with:
          xcode-version: 'latest-stable'

      - name: Create exportOptions.plist placeholder
        run: |
          # exportOptions.plist å°†åœ¨è¯ä¹¦å®‰è£…åŽåˆ›å»º
          echo "exportOptions.plist will be created after certificate installation"

      - name: Install certificates and provisioning profiles

        run: |
          # åˆ›å»ºä¸´æ—¶keychain
          security create-keychain -p "${{ secrets.KEYCHAIN_PASSWORD }}" build.keychain
          security default-keychain -s build.keychain
          security unlock-keychain -p "${{ secrets.KEYCHAIN_PASSWORD }}" build.keychain
          security set-keychain-settings -t 3600 -u build.keychain
          
          # å¯¼å…¥è¯ä¹¦
          echo "${{ secrets.IOS_CERTIFICATE_BASE64 }}" | base64 --decode > certificate.p12
          security import certificate.p12 -k build.keychain -P "${{ secrets.IOS_CERTIFICATE_PASSWORD }}" -T /usr/bin/codesign
          security set-key-partition-list -S apple-tool:,apple: -s -k "${{ secrets.KEYCHAIN_PASSWORD }}" build.keychain
          
          # å®‰è£…provisioning profile
          mkdir -p ~/Library/MobileDevice/Provisioning\ Profiles
          echo "${{ secrets.IOS_PROVISIONING_PROFILE_BASE64 }}" | base64 --decode > profile.mobileprovision
          
          # èŽ·å– Profile UUIDï¼ˆä½¿ç”¨ security å‘½ä»¤è§£æžï¼‰
          PROFILE_UUID=$(security cms -D -i profile.mobileprovision | plutil -extract UUID raw -)
          echo "PROFILE_UUID=$PROFILE_UUID" >> $GITHUB_ENV
          echo "Installed Profile UUID: $PROFILE_UUID"
          
          # èŽ·å– Profile åç§°ï¼ˆç”¨äºŽ exportOptions.plistï¼‰
          PROFILE_NAME=$(security cms -D -i profile.mobileprovision | plutil -extract Name raw -)
          echo "PROFILE_NAME=$PROFILE_NAME" >> $GITHUB_ENV
          echo "Profile Name: $PROFILE_NAME"
          
          # ä»Ž app.cfg è¯»å–å®žé™…çš„ Bundle IDï¼ˆæ”¯æŒé€šé…ç¬¦ Profileï¼‰
          # ä¸å†ä»Ž Profile ä¸­æå–ï¼Œå› ä¸º Profile å¯èƒ½æ˜¯é€šé…ç¬¦ï¼ˆå¦‚ com.xlab.*ï¼‰
          APP_NAME=$(cat assets/build.app | grep appName | cut -d'=' -f2)
          BUNDLE_ID=$(grep "^appId=" assets/${APP_NAME}/app.cfg | cut -d'=' -f2)
          echo "BUNDLE_ID=$BUNDLE_ID" >> $GITHUB_ENV
          echo "Bundle ID from app.cfg: $BUNDLE_ID"
          
          # éªŒè¯ Profile çš„ App IDï¼ˆç”¨äºŽè°ƒè¯•ï¼‰
          PROFILE_APP_ID=$(security cms -D -i profile.mobileprovision | plutil -extract Entitlements.application-identifier raw - | sed 's/^[^.]*\.//')
          echo "Profile App ID: $PROFILE_APP_ID"
          
          # å¤åˆ¶ Profile åˆ°æ­£ç¡®çš„ä½ç½®ï¼ˆä½¿ç”¨ UUID ä½œä¸ºæ–‡ä»¶åï¼‰
          cp profile.mobileprovision ~/Library/MobileDevice/Provisioning\ Profiles/${PROFILE_UUID}.mobileprovision
          
          # åˆ—å‡ºæ‰€æœ‰å¯ç”¨çš„ç­¾åèº«ä»½ï¼ˆç”¨äºŽè°ƒè¯•ï¼‰
          echo "Available signing identities:"
          security find-identity -v -p codesigning build.keychain
          
          # èŽ·å–è¯ä¹¦èº«ä»½ï¼ˆSHA-1 hashï¼‰
          CERT_IDENTITY=$(security find-identity -v -p codesigning build.keychain | grep "Apple Distribution" | head -1 | awk '{print $2}')
          echo "CERT_IDENTITY=$CERT_IDENTITY" >> $GITHUB_ENV
          echo "Certificate Identity: $CERT_IDENTITY"
          
          # å¦‚æžœæ²¡æœ‰æ‰¾åˆ° Apple Distributionï¼Œå°è¯•æŸ¥æ‰¾ iPhone Distribution
          if [ -z "$CERT_IDENTITY" ]; then
            CERT_IDENTITY=$(security find-identity -v -p codesigning build.keychain | grep "iPhone Distribution" | head -1 | awk '{print $2}')
            echo "CERT_IDENTITY=$CERT_IDENTITY" >> $GITHUB_ENV
            echo "Certificate Identity (iPhone): $CERT_IDENTITY"
          fi
          
          # è®¾ç½® export method å’Œ team ID ä¸º shell å˜é‡
          EXPORT_METHOD="${{ secrets.IOS_EXPORT_METHOD }}"
          if [ -z "$EXPORT_METHOD" ]; then
            EXPORT_METHOD="app-store"
          fi
          TEAM_ID="${{ secrets.IOS_TEAM_ID }}"
          
          echo "Export Method: $EXPORT_METHOD"
          echo "Team ID: $TEAM_ID"
          
          # åˆ›å»º exportOptions.plistï¼ˆä½¿ç”¨ Profile åç§°æ”¯æŒé€šé…ç¬¦ï¼‰
          cat > ios/exportOptions.plist << EOF
          <?xml version="1.0" encoding="UTF-8"?>
          <!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
          <plist version="1.0">
          <dict>
              <key>method</key>
              <string>${EXPORT_METHOD}</string>
              <key>teamID</key>
              <string>${TEAM_ID}</string>
              <key>uploadBitcode</key>
              <false/>
              <key>uploadSymbols</key>
              <true/>
              <key>compileBitcode</key>
              <false/>
              <key>signingStyle</key>
              <string>manual</string>
              <key>signingCertificate</key>
              <string>Apple Distribution</string>
              <key>provisioningProfiles</key>
              <dict>
                  <key>${BUNDLE_ID}</key>
                  <string>${PROFILE_NAME}</string>
              </dict>
          </dict>
          </plist>
          EOF
          
          echo "=== Created exportOptions.plist ==="
          cat ios/exportOptions.plist
          echo "=== End of exportOptions.plist ==="

      - name: Build iOS app (Debug)
        if: needs.prepare.outputs.need_debug == 'true'
        run: |
          cd ios
          xcodebuild -project WebViewApp.xcodeproj \
            -scheme WebViewApp \
            -configuration Debug \
            -sdk iphonesimulator \
            -derivedDataPath build-debug \
            CODE_SIGN_IDENTITY="" \
            CODE_SIGNING_REQUIRED=NO \
            CODE_SIGNING_ALLOWED=NO

      - name: Build iOS app (Release)
        run: |
          cd ios
          xcodebuild -project WebViewApp.xcodeproj \
            -scheme WebViewApp \
            -configuration Release \
            -sdk iphoneos \
            -derivedDataPath build-release \
            -archivePath build-release/WebViewApp.xcarchive \
            -allowProvisioningUpdates \
            CODE_SIGN_STYLE=Manual \
            DEVELOPMENT_TEAM="${{ secrets.IOS_TEAM_ID }}" \
            CODE_SIGN_IDENTITY="${CERT_IDENTITY}" \
            PROVISIONING_PROFILE_SPECIFIER="${PROFILE_NAME}" \
            archive
          
          # å¯¼å‡ºIPA
          xcodebuild -exportArchive \
            -archivePath build-release/WebViewApp.xcarchive \
            -exportPath build-release/output \
            -exportOptionsPlist exportOptions.plist \
            -allowProvisioningUpdates

      - name: Generate App Screenshots
        run: |
          # è¯»å–é…ç½®
          APP_NAME=$(grep 'appName=' assets/build.app | cut -d'=' -f2)
          CONFIG_FILE="assets/$APP_NAME/app.cfg"
          ENABLE_SCREENSHOT=$(grep '^enableScreenshotGeneration=' $CONFIG_FILE | cut -d'=' -f2 | tr '[:upper:]' '[:lower:]')
          
          if [ "$ENABLE_SCREENSHOT" = "true" ]; then
            echo "ðŸ“¸ ç”Ÿæˆ App Store æˆªå›¾..."
            python3 scripts/generate_app_screenshots.py ${{ github.workspace }}
          else
            echo "â„¹ï¸  æˆªå›¾ç”Ÿæˆå·²ç¦ç”¨ (enableScreenshotGeneration=false)"
          fi
        continue-on-error: true

      - name: Check and setup App Store Connect
        run: |
          # è¯»å–é…ç½®
          APP_NAME=$(grep 'appName=' assets/build.app | cut -d'=' -f2)
          CONFIG_FILE="assets/$APP_NAME/app.cfg"
          ENABLE_ASC=$(grep '^enableAppStoreConnect=' $CONFIG_FILE | cut -d'=' -f2 | tr '[:upper:]' '[:lower:]')
          
          if [ "$ENABLE_ASC" = "true" ]; then
            echo "ðŸ”„ App Store Connect æ£€æŸ¥å’Œé…ç½®å·²å¯ç”¨"
            
            # åˆ›å»ºç§é’¥ç›®å½•
            mkdir -p ~/.appstoreconnect/private_keys
            
            # è§£ç  API å¯†é’¥å¹¶ä¿å­˜åˆ°æ­£ç¡®çš„ä½ç½®å’Œæ–‡ä»¶å
            echo "${{ secrets.APP_STORE_API_KEY_BASE64 }}" | base64 --decode > ~/.appstoreconnect/private_keys/AuthKey_${{ secrets.APP_STORE_API_KEY_ID }}.p8
            
            # è®¾ç½®æ–‡ä»¶æƒé™
            chmod 600 ~/.appstoreconnect/private_keys/AuthKey_${{ secrets.APP_STORE_API_KEY_ID }}.p8
            
            # è¿è¡Œ App Store Connect æ£€æŸ¥è„šæœ¬
            # è¿™å°†æ£€æŸ¥åº”ç”¨æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æžœä¸å­˜åœ¨åˆ™åˆ›å»ºï¼Œå¹¶ä¸Šä¼ å…ƒæ•°æ®å’Œæˆªå›¾
            python3 scripts/app_store_connect.py ${{ github.workspace }}
          else
            echo "â„¹ï¸  App Store Connect æ£€æŸ¥å·²ç¦ç”¨ (enableAppStoreConnect=false)"
            echo "æç¤º: å¦‚éœ€è‡ªåŠ¨åˆ›å»ºåº”ç”¨å’Œä¸Šä¼ å…ƒæ•°æ®ï¼Œè¯·åœ¨ app.cfg ä¸­è®¾ç½® enableAppStoreConnect=true"
          fi
        env:
          APP_STORE_API_KEY_ID: ${{ secrets.APP_STORE_API_KEY_ID }}
          APP_STORE_API_ISSUER_ID: ${{ secrets.APP_STORE_API_ISSUER_ID }}
        continue-on-error: true

      - name: Upload to TestFlight
        run: |
          # ä¸Šä¼  IPA
          xcrun altool --upload-app \
            --file ios/build-release/output/WebViewApp.ipa \
            --type ios \
            --apiKey ${{ secrets.APP_STORE_API_KEY_ID }} \
            --apiIssuer ${{ secrets.APP_STORE_API_ISSUER_ID }}

      - name: Upload iOS Debug App
        if: needs.prepare.outputs.need_debug == 'true'
        uses: actions/upload-artifact@v4
        with:
          name: ios-app-debug
          path: ios/build-debug/Build/Products/Debug-iphonesimulator/*.app

      - name: Upload iOS Release IPA
        uses: actions/upload-artifact@v4
        with:
          name: ios-ipa-release
          path: ios/build-release/output/*.ipa

  release:
    name: Create Release
    needs: [prepare, build-android, build-ios]
    if: |
      always() && 
      (needs.build-android.result == 'success' || needs.build-android.result == 'skipped') &&
      (needs.build-ios.result == 'success' || needs.build-ios.result == 'skipped')
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      - name: Download Android Debug APK
        if: needs.prepare.outputs.build_android == 'true' && needs.prepare.outputs.need_debug == 'true'
        uses: actions/download-artifact@v4
        with:
          name: android-apk-debug
          path: ./artifacts/android/debug
        continue-on-error: true

      - name: Download Android Release APK
        if: needs.prepare.outputs.build_android == 'true'
        uses: actions/download-artifact@v4
        with:
          name: android-apk-release
          path: ./artifacts/android/release

      - name: Download iOS Debug App
        if: needs.prepare.outputs.build_ios == 'true' && needs.prepare.outputs.need_debug == 'true'
        uses: actions/download-artifact@v4
        with:
          name: ios-app-debug
          path: ./artifacts/ios/debug
        continue-on-error: true

      - name: Download iOS Release IPA
        if: needs.prepare.outputs.build_ios == 'true'
        uses: actions/download-artifact@v4
        with:
          name: ios-ipa-release
          path: ./artifacts/ios/release

      - name: Download Screenshots
        run: |
          # èŽ·å–åº”ç”¨åç§°
          APP_NAME=$(grep 'appName=' assets/build.app | cut -d'=' -f2)
          
          # æ£€æŸ¥æˆªå›¾ç›®å½•æ˜¯å¦å­˜åœ¨
          if [ -d "screenshots/$APP_NAME" ]; then
            echo "ðŸ“¸ å¤åˆ¶æˆªå›¾åˆ° artifacts"
            mkdir -p ./artifacts/screenshots
            cp -r screenshots/$APP_NAME ./artifacts/screenshots/
            
            # åˆ›å»ºæˆªå›¾è¯´æ˜Žæ–‡ä»¶
            cat > ./artifacts/screenshots/README.txt <<'HEREDOC'
App Store æˆªå›¾
=============

è¿™äº›æˆªå›¾æ˜¯ä»Ž splashScreen å›¾ç‰‡è‡ªåŠ¨ç”Ÿæˆçš„ï¼Œç¬¦åˆ App Store è¦æ±‚çš„å°ºå¯¸ã€‚

è®¾å¤‡ç±»åž‹å’Œå°ºå¯¸:
- iPhone 6.7: 1290 x 2796 (iPhone 14/15 Pro Max)
- iPhone 6.5: 1242 x 2688 (iPhone 11 Pro Max, XS Max)
- iPhone 5.5: 1242 x 2208 (iPhone 8 Plus)
- iPad 12.9 (3rd): 2048 x 2732 (iPad Pro 12.9" ç¬¬3ä»£åŠä»¥åŽ)

ä½¿ç”¨è¯´æ˜Ž:
1. è¿™äº›æˆªå›¾å¯ä»¥ç›´æŽ¥ç”¨äºŽ App Store Connect
2. å»ºè®®å‡†å¤‡ 3-5 å¼ å±•ç¤ºä¸åŒåŠŸèƒ½çš„æˆªå›¾
3. æ‰‹åŠ¨åœ¨ App Store Connect ä¸Šä¼ æ›´å¤šæˆªå›¾ä»¥å±•ç¤ºåº”ç”¨åŠŸèƒ½
HEREDOC
            
            echo "âœ… æˆªå›¾å·²å¤åˆ¶åˆ° artifacts/screenshots/$APP_NAME"
          else
            echo "â„¹ï¸  æœªæ‰¾åˆ°æˆªå›¾ç›®å½•ï¼Œè·³è¿‡"
          fi
        continue-on-error: true

      - name: Rename artifacts for release
        run: |
          # æ˜¾ç¤ºä¸‹è½½çš„æ–‡ä»¶ç»“æž„ï¼ˆç”¨äºŽè°ƒè¯•ï¼‰
          echo "=== Downloaded artifacts structure ==="
          ls -lR ./artifacts/ || echo "No artifacts directory found"
          
          # é‡å‘½å Android APK æ–‡ä»¶
          if [ -d "./artifacts/android" ]; then
            echo "=== Processing Android artifacts ==="
            find ./artifacts/android -name "*.apk" -type f | while read file; do
              dir=$(dirname "$file")
              base=$(basename "$file")
              echo "Found APK: $file"
              # é‡å‘½åä¸ºå¸¦ç‰ˆæœ¬å·çš„æ–‡ä»¶å
              mv "$file" "$dir/WebViewApp-${{ needs.prepare.outputs.app_version }}-${base}"
              echo "Renamed to: $dir/WebViewApp-${{ needs.prepare.outputs.app_version }}-${base}"
            done
          else
            echo "Warning: No Android artifacts found"
          fi
          
          # å¤„ç† iOS artifacts
          if [ -d "./artifacts/ios" ]; then
            echo "=== Processing iOS artifacts ==="
            # å¤„ç† IPA æ–‡ä»¶
            find ./artifacts/ios -name "*.ipa" -type f | while read file; do
              dir=$(dirname "$file")
              echo "Found IPA: $file"
              mv "$file" "$dir/WebViewApp-${{ needs.prepare.outputs.app_version }}.ipa"
              echo "Renamed to: $dir/WebViewApp-${{ needs.prepare.outputs.app_version }}.ipa"
            done
            
            # åŽ‹ç¼© .app æ–‡ä»¶
            find ./artifacts/ios -name "*.app" -type d | while read app; do
              dir=$(dirname "$app")
              appname=$(basename "$app" .app)
              echo "Found APP: $app"
              (cd "$dir" && zip -r "WebViewApp-${{ needs.prepare.outputs.app_version }}-Debug.zip" "$(basename "$app")")
              echo "Created ZIP: $dir/WebViewApp-${{ needs.prepare.outputs.app_version }}-Debug.zip"
              rm -rf "$app"
            done
          else
            echo "Warning: No iOS artifacts found"
          fi
          
          # åŽ‹ç¼©æˆªå›¾ç›®å½•ï¼ˆå¦‚æžœå­˜åœ¨ï¼‰
          if [ -d "./artifacts/screenshots" ]; then
            echo "=== Compressing screenshots ==="
            (cd ./artifacts/screenshots && zip -r ../Screenshots-${{ needs.prepare.outputs.app_version }}.zip *)
            echo "Created ZIP: ./artifacts/Screenshots-${{ needs.prepare.outputs.app_version }}.zip"
            rm -rf ./artifacts/screenshots
          fi
          
          # æ˜¾ç¤ºæœ€ç»ˆæ–‡ä»¶åˆ—è¡¨
          echo "=== Final artifacts ==="
          ls -lR ./artifacts/ || echo "No artifacts"

      - name: Create Release
        uses: softprops/action-gh-release@v2
        with:
          token: ${{ secrets.TOKEN }}
          tag_name: ${{ github.ref_name }}
          name: Release ${{ github.ref_name }}
          body: |
            ## WebView App Release ${{ github.ref_name }}
            
            **Version**: ${{ needs.prepare.outputs.app_version }}
            **Build Mode**: ${{ needs.prepare.outputs.need_debug == 'true' && 'Debug + Release' || 'Release Only' }}
            
            ### What's Included
            
            ${{ needs.prepare.outputs.build_android == 'true' && '- âœ… Android APK' || '- âŒ Android (disabled)' }}
            ${{ needs.prepare.outputs.build_ios == 'true' && '- âœ… iOS IPA/App' || '- âŒ iOS (disabled)' }}
            
            ### Installation
            
            #### Android
            1. ä¸‹è½½ APK æ–‡ä»¶
            2. åœ¨è®¾å¤‡ä¸Šå¯ç”¨"æœªçŸ¥æ¥æº"å®‰è£…
            3. å®‰è£… APK
            
            #### iOS (Debug)
            1. ä¸‹è½½ ZIP æ–‡ä»¶å¹¶è§£åŽ‹
            2. ä½¿ç”¨ Xcode æˆ–å…¶ä»–å·¥å…·å®‰è£…åˆ°æ¨¡æ‹Ÿå™¨
            
            #### iOS (Release)
            1. ä¸‹è½½ IPA æ–‡ä»¶
            2. ä½¿ç”¨ Apple Configurator æˆ– TestFlight å®‰è£…åˆ°è®¾å¤‡
            
            ---
            *This release was automatically generated by GitHub Actions*
          draft: false
          prerelease: false
          files: |
            ./artifacts/**/*.apk
            ./artifacts/**/*.ipa
            ./artifacts/**/*.zip
            ./artifacts/Screenshots-*.zip
          fail_on_unmatched_files: false
